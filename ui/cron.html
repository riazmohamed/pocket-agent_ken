<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">
  <title>Routines - Pocket Agent</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0b;
      --bg-secondary: #141415;
      --bg-tertiary: #1c1c1e;
      --border: #2a2a2d;
      --text-primary: #fafafa;
      --text-secondary: #a1a1a6;
      --text-muted: #636366;
      --accent: #a855f7;
      --accent-secondary: #ec4899;
      --accent-hover: #c084fc;
      --success: #22c55e;
      --error: #ef4444;
      --warning: #f59e0b;
      --radius: 16px;
      --radius-sm: 10px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Sora', -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    header {
      background: var(--bg-secondary);
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-family: 'Sora', sans-serif;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    header h1 span {
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .header-actions button {
      padding: 6px 14px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.15s;
    }

    .header-actions button:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 20px 24px 32px 24px;
    }

    .content::-webkit-scrollbar {
      width: 6px;
    }

    .content::-webkit-scrollbar-track {
      background: transparent;
    }

    .content::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      letter-spacing: -0.02em;
    }

    .section-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    /* Settings Grid - matching settings.html */
    .settings-grid {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      border-bottom: 1px solid var(--border);
      gap: 12px;
    }

    .setting-row:last-child {
      border-bottom: none;
    }

    .setting-row:hover {
      background: var(--bg-tertiary);
    }

    .setting-row label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin: 0;
      white-space: nowrap;
    }

    .setting-row input,
    .setting-row select,
    .setting-row textarea {
      flex: 1;
      max-width: 280px;
      padding: 6px 10px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 12px;
      font-family: inherit;
      outline: none;
    }

    .setting-row input:focus,
    .setting-row select:focus,
    .setting-row textarea:focus {
      border-color: var(--accent);
    }

    .setting-row input::placeholder,
    .setting-row textarea::placeholder {
      color: var(--text-muted);
    }

    .setting-row select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12' fill='%23636366'%3E%3Cpath d='M6 8L2 4h8L6 8z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      padding-right: 24px;
    }

    .setting-row textarea {
      min-height: 60px;
      resize: vertical;
      line-height: 1.4;
    }

    /* Schedule tabs */
    .schedule-tabs {
      display: flex;
      gap: 4px;
    }

    .schedule-tab {
      padding: 5px 10px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .schedule-tab:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    .schedule-tab.active {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
      border-color: var(--accent);
      color: var(--text-primary);
    }

    /* Time picker */
    .time-picker {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .time-picker select {
      width: 54px;
      text-align: center;
      padding: 6px 4px;
    }

    .time-picker .separator {
      color: var(--text-muted);
      font-weight: 600;
      font-size: 12px;
    }

    /* Day selector */
    .day-selector {
      display: flex;
      gap: 4px;
    }

    .day-btn {
      width: 28px;
      height: 28px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg-primary);
      color: var(--text-muted);
      font-size: 10px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .day-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    .day-btn.selected {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
      border-color: transparent;
      color: white;
    }

    /* Interval input */
    .interval-input {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .interval-input input {
      width: 50px;
      text-align: center;
    }

    .interval-input select {
      width: 80px;
    }

    /* Schedule options container */
    .schedule-options {
      display: none;
    }

    .schedule-options.active {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Create button */
    .create-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 2px 8px rgba(168, 85, 247, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .create-btn:hover {
      background: linear-gradient(135deg, var(--accent-hover) 0%, var(--accent) 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(168, 85, 247, 0.35);
    }

    .create-btn svg {
      width: 14px;
      height: 14px;
    }

    /* Jobs list */
    .jobs-list {
      display: flex;
      flex-direction: column;
    }

    .job-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      transition: all 0.15s ease;
      animation: fadeIn 0.2s ease;
    }

    .job-item:last-child {
      border-bottom: none;
    }

    .job-item:hover {
      background: var(--bg-tertiary);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .job-item.disabled {
      opacity: 0.5;
    }

    .job-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
      box-shadow: 0 0 8px var(--accent);
      flex-shrink: 0;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(0.9); }
    }

    .job-item.disabled .job-status {
      background: var(--text-muted);
      box-shadow: none;
      animation: none;
    }

    .job-info {
      flex: 1;
      min-width: 0;
    }

    .job-name {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 2px;
    }

    .job-schedule {
      font-size: 11px;
      color: var(--accent);
      font-weight: 500;
    }

    .job-prompt {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .job-actions {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }

    .icon-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s;
    }

    .icon-btn:hover {
      background: var(--border);
      color: var(--text-primary);
    }

    .icon-btn.danger:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: var(--error);
      color: var(--error);
    }

    .icon-btn svg {
      width: 12px;
      height: 12px;
    }

    .empty-state {
      text-align: center;
      padding: 32px 16px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 32px;
      height: 32px;
      margin-bottom: 8px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 12px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      padding: 10px 14px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: slideIn 0.3s ease;
      z-index: 1000;
    }

    .toast.success { border-color: var(--success); color: var(--success); }
    .toast.error { border-color: var(--error); color: var(--error); }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Full width row for prompt */
    .setting-row.full-width {
      flex-direction: column;
      align-items: stretch;
      gap: 6px;
    }

    .setting-row.full-width textarea {
      max-width: none;
    }

    /* Schedule row with nested elements */
    .setting-row.schedule-row {
      flex-wrap: wrap;
      gap: 8px;
    }

    .setting-row.schedule-row > label {
      width: 100%;
      margin-bottom: -4px;
    }
  </style>
</head>
<body>
  <header>
    <h1><span>Routines</span></h1>
    <div class="header-actions">
      <button onclick="window.close()">Done</button>
    </div>
  </header>

  <main class="content">
    <section class="section">
      <div class="settings-grid">
        <div class="setting-row">
          <label>Job Name</label>
          <input type="text" id="job-name" placeholder="morning-vibes" />
        </div>

        <div class="setting-row schedule-row">
          <label>When</label>
          <div class="schedule-tabs">
            <div class="schedule-tab active" data-type="daily">Daily</div>
            <div class="schedule-tab" data-type="weekdays">Weekdays</div>
            <div class="schedule-tab" data-type="interval">Every...</div>
            <div class="schedule-tab" data-type="custom">Specific Days</div>
          </div>

          <div class="schedule-options active" id="options-daily">
            <div class="time-picker">
              <select id="hour-daily"></select>
              <span class="separator">:</span>
              <select id="minute-daily"></select>
              <select id="ampm-daily">
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
          </div>

          <div class="schedule-options" id="options-weekdays">
            <div class="time-picker">
              <select id="hour-weekdays"></select>
              <span class="separator">:</span>
              <select id="minute-weekdays"></select>
              <select id="ampm-weekdays">
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
          </div>

          <div class="schedule-options" id="options-interval">
            <div class="interval-input">
              <input type="number" id="interval-value" value="30" min="1" max="60" />
              <select id="interval-unit">
                <option value="minutes">minutes</option>
                <option value="hours">hours</option>
              </select>
            </div>
          </div>

          <div class="schedule-options" id="options-custom">
            <div class="day-selector">
              <button type="button" class="day-btn" data-day="0">Su</button>
              <button type="button" class="day-btn" data-day="1">Mo</button>
              <button type="button" class="day-btn" data-day="2">Tu</button>
              <button type="button" class="day-btn" data-day="3">We</button>
              <button type="button" class="day-btn" data-day="4">Th</button>
              <button type="button" class="day-btn" data-day="5">Fr</button>
              <button type="button" class="day-btn" data-day="6">Sa</button>
            </div>
            <div class="time-picker">
              <select id="hour-custom"></select>
              <span class="separator">:</span>
              <select id="minute-custom"></select>
              <select id="ampm-custom">
                <option value="AM">AM</option>
                <option value="PM">PM</option>
              </select>
            </div>
          </div>
        </div>

        <div class="setting-row full-width">
          <label>Prompt</label>
          <textarea id="job-prompt" placeholder="what should i do when this kicks off? âœ¨"></textarea>
        </div>

        <div class="setting-row">
          <label></label>
          <button class="create-btn" onclick="createJob()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Let's Go!
          </button>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Running on Autopilot</h2>
      <p class="section-desc">Your scheduled routines.</p>

      <div class="settings-grid">
        <div id="jobs-list" class="jobs-list">
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <p>Loading...</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Generate hour options (1-12)
    function generateHourOptions() {
      let html = '';
      for (let i = 1; i <= 12; i++) {
        const selected = i === 9 ? 'selected' : '';
        html += `<option value="${i}" ${selected}>${i}</option>`;
      }
      return html;
    }

    // Generate minute options (00, 15, 30, 45)
    function generateMinuteOptions() {
      return `
        <option value="0">00</option>
        <option value="15">15</option>
        <option value="30">30</option>
        <option value="45">45</option>
      `;
    }

    // Insert generated options
    document.querySelectorAll('select[id^="hour-"]').forEach(el => {
      el.innerHTML = generateHourOptions();
    });
    document.querySelectorAll('select[id^="minute-"]').forEach(el => {
      el.innerHTML = generateMinuteOptions();
    });

    // Schedule type tabs
    let currentScheduleType = 'daily';
    const selectedDays = new Set();

    document.querySelectorAll('.schedule-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.schedule-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.schedule-options').forEach(o => o.classList.remove('active'));

        tab.classList.add('active');
        currentScheduleType = tab.dataset.type;
        document.getElementById(`options-${currentScheduleType}`).classList.add('active');
      });
    });

    // Day selector buttons
    document.querySelectorAll('.day-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const day = btn.dataset.day;
        if (selectedDays.has(day)) {
          selectedDays.delete(day);
          btn.classList.remove('selected');
        } else {
          selectedDays.add(day);
          btn.classList.add('selected');
        }
      });
    });

    // Convert 12h to 24h
    function to24Hour(hour, minute, ampm) {
      let h = parseInt(hour);
      if (ampm === 'PM' && h !== 12) h += 12;
      if (ampm === 'AM' && h === 12) h = 0;
      return { hour: h, minute: parseInt(minute) };
    }

    // Build cron expression from UI
    function buildCronExpression() {
      if (currentScheduleType === 'interval') {
        const value = document.getElementById('interval-value').value;
        const unit = document.getElementById('interval-unit').value;
        if (unit === 'minutes') {
          return `*/${value} * * * *`;
        } else {
          return `0 */${value} * * *`;
        }
      }

      const suffix = currentScheduleType === 'weekdays' ? 'weekdays' :
                     currentScheduleType === 'custom' ? 'custom' : 'daily';

      const hour = document.getElementById(`hour-${suffix}`).value;
      const minute = document.getElementById(`minute-${suffix}`).value;
      const ampm = document.getElementById(`ampm-${suffix}`).value;
      const time = to24Hour(hour, minute, ampm);

      if (currentScheduleType === 'daily') {
        return `${time.minute} ${time.hour} * * *`;
      } else if (currentScheduleType === 'weekdays') {
        return `${time.minute} ${time.hour} * * 1-5`;
      } else if (currentScheduleType === 'custom') {
        if (selectedDays.size === 0) {
          return `${time.minute} ${time.hour} * * *`;
        }
        const days = Array.from(selectedDays).sort().join(',');
        return `${time.minute} ${time.hour} * * ${days}`;
      }
    }

    // Convert cron to human-readable
    function cronToHuman(cron) {
      if (!cron) return 'Unknown schedule';

      const parts = cron.split(' ');
      if (parts.length !== 5) return cron;

      const [minute, hour, dom, month, dow] = parts;

      // Interval patterns
      if (minute.startsWith('*/')) {
        const mins = minute.slice(2);
        return `Every ${mins} minutes`;
      }
      if (hour.startsWith('*/')) {
        const hrs = hour.slice(2);
        return `Every ${hrs} hour${hrs === '1' ? '' : 's'}`;
      }

      // Time-based patterns
      const h = parseInt(hour);
      const m = parseInt(minute);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const displayHour = h === 0 ? 12 : h > 12 ? h - 12 : h;
      const displayMinute = m.toString().padStart(2, '0');
      const timeStr = `${displayHour}:${displayMinute} ${ampm}`;

      // Day patterns
      if (dow === '*' && dom === '*') {
        return `${timeStr} daily`;
      }
      if (dow === '1-5') {
        return `${timeStr} weekdays`;
      }
      if (dow === '0,6') {
        return `${timeStr} weekends`;
      }
      if (dow !== '*') {
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const days = dow.split(',').map(d => dayNames[parseInt(d)]).join(', ');
        return `${timeStr} on ${days}`;
      }

      return `${timeStr} daily`;
    }

    const jobsList = document.getElementById('jobs-list');

    window.addEventListener('DOMContentLoaded', loadJobs);

    async function loadJobs() {
      try {
        const jobs = await window.pocketAgent.getCronJobs();

        if (jobs.length === 0) {
          jobsList.innerHTML = `
            <div class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <p>nothing scheduled yet!</p>
            </div>
          `;
          return;
        }

        jobsList.innerHTML = jobs.map((job, i) => `
          <div class="job-item ${job.enabled ? '' : 'disabled'}" style="animation-delay: ${i * 50}ms">
            <div class="job-status"></div>
            <div class="job-info">
              <div class="job-name">${escapeHtml(job.name)}</div>
              <div class="job-schedule">${cronToHuman(job.schedule)}</div>
              <div class="job-prompt">${escapeHtml(job.prompt)}</div>
            </div>
            <div class="job-actions">
              <button class="icon-btn" onclick="toggleJob('${escapeAttr(job.name)}', ${!job.enabled})" title="${job.enabled ? 'Pause' : 'Resume'}">
                ${job.enabled
                  ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>'
                  : '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>'
                }
              </button>
              <button class="icon-btn" onclick="runJob('${escapeAttr(job.name)}')" title="Run now">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
              </button>
              <button class="icon-btn danger" onclick="deleteJob('${escapeAttr(job.name)}')" title="Delete">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>
            </div>
          </div>
        `).join('');
      } catch (err) {
        jobsList.innerHTML = `<div class="empty-state"><p>Error: ${escapeHtml(err.message)}</p></div>`;
      }
    }

    async function createJob() {
      const name = document.getElementById('job-name').value.trim();
      const prompt = document.getElementById('job-prompt').value.trim();

      if (!name || !prompt) {
        showToast('Please fill in name and prompt', 'error');
        return;
      }

      const schedule = buildCronExpression();

      try {
        const result = await window.pocketAgent.createCronJob(name, schedule, prompt, 'default');
        if (result.success) {
          document.getElementById('job-name').value = '';
          document.getElementById('job-prompt').value = '';
          showToast('Routine created! ðŸŽ‰', 'success');
          loadJobs();
        } else {
          showToast('Failed to create routine', 'error');
        }
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    async function toggleJob(name, enabled) {
      try {
        await window.pocketAgent.toggleCronJob(name, enabled);
        showToast(enabled ? 'Resumed' : 'Paused', 'success');
        loadJobs();
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    async function runJob(name) {
      showToast('Running...', 'success');
      try {
        await window.pocketAgent.runCronJob(name);
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    async function deleteJob(name) {
      if (!confirm(`Delete "${name}"?`)) return;

      try {
        await window.pocketAgent.deleteCronJob(name);
        showToast('Poof! Gone.', 'success');
        loadJobs();
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    function showToast(message, type = 'success') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function escapeAttr(text) {
      return text.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }
  </script>
</body>
</html>
